# Dart 中的常量、不变性与对象标识

这个目录包含了与 Dart 中常量定义、不可变对象和对象标识相关的示例代码。通过这些示例，您可以学习 `const`、`final`、`identical` 函数的使用以及常量构造函数的实现。

## 文件说明

### 1. `const_vs_final.dart`

这个文件介绍了 `const` 和 `final` 关键字的区别和用法：

- **const**：编译时常量，必须在编译时就能确定值
- **final**：运行时常量，值可以在运行时确定，一旦赋值后不能修改

关键知识点：

- `const` 变量的值必须在编译时确定
- `final` 变量可以使用运行时表达式赋值
- `const` 集合内的元素也必须是常量
- `final` 集合虽然引用不能改变，但内容可以修改
- 使用 `const` 修饰对象可以在内存中共享实例

### 2. `const_constructor.dart`

这个文件详细演示了常量构造函数的定义和使用：

- 常量构造函数的声明与实现
- 命名常量构造函数
- 嵌套常量对象
- 常量集合的使用

关键知识点：

- 常量构造函数需要使用 `const` 关键字声明
- 所有实例变量必须是 `final`
- 相同值的常量对象在内存中只有一个实例
- 常量构造函数不能有函数体，只能有初始化列表
- 抽象类也可以有常量构造函数

### 3. `identical_function.dart`

这个文件演示了 `identical` 函数的用法和原理：

- 基本类型比较
- 对象实例比较
- 常量对象比较
- `identical` 与 `==` 运算符的区别

关键知识点：

- `identical` 用于检查两个对象是否是内存中的同一个实例
- `==` 运算符默认比较对象引用，但可以被重载为值比较
- 重写 `==` 运算符时必须同时重写 `hashCode`
- 字符串字面量在 Dart 中通常会被内部化(interned)

### 4. `memory_and_identity.dart`

这个文件详细讲解了 `identical` 函数和 Dart 内存管理的关系：

- 基本类型的内存管理
- 字符串的内部处理
- 常量对象与内存优化
- 垃圾回收与对象标识

关键知识点：

- Dart 中的小整数通常会被缓存
- 字符串字面量会被内部化处理，相同内容只存储一次
- `const` 对象可以减少内存使用
- 对象标识在其生命周期内是唯一的

### 5. `comprehensive_example.dart`

这个文件综合展示了 `const`、`final`、`identical` 和常量构造函数的结合使用：

- 不可变应用配置
- 不可变集合
- 值对象模式
- 不可变树状结构
- 性能优化

关键知识点：

- 不可变对象的优势：线程安全、缓存友好、对象一致性、安全共享
- 值对象模式的实现
- 嵌套的不可变数据结构
- 使用常量对象带来的性能优化

## 深入理解 const、final 和 identical

### const 与 final 的主要区别

| 特性 | const | final |
|------|-------|-------|
| 确定值的时机 | 编译时 | 运行时 |
| 嵌套内容 | 必须也是常量 | 可以是可变的 |
| 内存中的实例 | 相同值共享一个实例 | 每次创建新实例 |
| 适用场景 | 编译时已知的固定值 | 运行时才能确定的一次性赋值 |

### 常量构造函数的规则

1. 类的所有实例变量必须是 `final`
2. 构造函数必须使用 `const` 关键字声明
3. 不能有函数体，只能有初始化列表
4. 如果类继承自其他类，父类构造函数必须是 `const`

### identical 函数与 == 运算符

- `identical(a, b)` 检查 `a` 和 `b` 是否是同一个对象实例
- `a == b` 默认检查引用相等，但可以通过重写 `==` 运算符实现值相等的比较
- 重写 `==` 时必须同时重写 `hashCode` 以保持一致性

### 内存优化与性能提升

使用 `const` 和常量构造函数可以带来以下好处：

1. 相同的常量对象只会在内存中存储一次
2. 编译时常量可以提高程序性能
3. 不可变对象简化状态管理，尤其在并发环境中

## 最佳实践

1. **使用 const 优先于 final**：如果值在编译时已知，优先使用 `const`
2. **值对象使用常量构造函数**：对于表示值的不可变对象，使用常量构造函数
3. **不可变集合**：使用 `const` 定义不可变集合，如 `const [1, 2, 3]`
4. **重写 == 和 hashCode**：为值对象重写这两个方法，实现基于内容的相等性比较
5. **缓存不可变对象**：利用常量对象的特性减少对象创建

## 学习资源

- [Dart 官方文档 - 变量](https://dart.dev/language/variables)
- [Dart 官方文档 - 内置类型](https://dart.dev/language/built-in-types)
- [Dart 官方文档 - 类](https://dart.dev/language/classes)
- [Dart 官方文档 - 构造函数](https://dart.dev/language/constructors)
